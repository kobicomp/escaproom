<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>מחולל חדרי בריחה מקוונים</title>
  <style>
    /* סגנון כללי */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #f5f5f5;
    }

    /* סגנון ממשק המחולל */
    .generator {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* סרגל צד */
    .sidebar {
      width: 300px;
      background-color: #2c3e50;
      color: white;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .sidebar h2 {
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 1px solid #465c6e;
      padding-bottom: 10px;
    }

    .sidebar-section {
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #ecf0f1;
    }

    /* אזור תצוגה מרכזי */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .toolbar {
      background-color: #34495e;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-area {
      flex: 1;
      background-color: #ecf0f1;
      overflow: auto;
      position: relative;
    }

    /* סגנון החדר */
    .room-preview {
      width: 800px;
      height: 600px;
      margin: 20px auto;
      position: relative;
      background-color: #fff;
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    /* אובייקטים בחדר */
    .room-item {
      position: absolute;
      cursor: move;
      border: 2px dashed transparent;
      background-color: rgba(52, 152, 219, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .room-item.selected {
      border-color: #3498db;
      background-color: rgba(52, 152, 219, 0.7);
    }

    /* לשוניות */
    .tabs {
      display: flex;
      background-color: #465c6e;
    }

    .tab {
      padding: 10px 15px;
      cursor: pointer;
      background-color: #465c6e;
      color: #ecf0f1;
      border: none;
      outline: none;
    }

    .tab:hover {
      background-color: #566c7e;
    }

    .tab.active {
      background-color: #34495e;
      border-bottom: 3px solid #3498db;
    }

    /* תפריט חדרים */
    .rooms-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .room-item-list {
      padding: 8px 10px;
      border-radius: 4px;
      margin-bottom: 5px;
      background-color: #34495e;
      cursor: pointer;
    }

    .room-item-list.active {
      background-color: #3498db;
    }

    /* תפריט אובייקטים */
    .object-gallery {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .object-thumbnail {
      width: 100%;
      height: 80px;
      background-color: #34495e;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 4px;
      color: white;
      font-weight: bold;
      text-align: center;
    }

    /* טפסים */
    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #465c6e;
      background-color: #34495e;
      color: white;
      border-radius: 4px;
    }

    /* כפתורים */
    .btn {
      padding: 8px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-secondary {
      background-color: #95a5a6;
    }

    .btn-success {
      background-color: #2ecc71;
    }

    .btn-danger {
      background-color: #e74c3c;
    }

    /* חלוניות מודאליות */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 1000;
      overflow: auto;
    }

    .modal-content {
      background-color: #ecf0f1;
      color: #2c3e50;
      margin: 50px auto;
      padding: 20px;
      width: 80%;
      max-width: 600px;
      border-radius: 4px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    .close-modal {
      float: left;
      font-size: 24px;
      cursor: pointer;
    }

    /* לשונית מפה */
    .map-editor {
      height: 100%;
      background-color: #ecf0f1;
      padding: 20px;
    }

    .map-container {
      width: 100%;
      height: 500px;
      background-color: white;
      border: 1px solid #bdc3c7;
      position: relative;
    }

    .map-room {
      position: absolute;
      width: 120px;
      height: 80px;
      background-color: #3498db;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: move;
    }

    .map-connection {
      position: absolute;
      background-color: #7f8c8d;
      z-index: -1;
    }

    /* לשונית חידות */
    .puzzle-editor {
      padding: 20px;
    }

    .puzzle-list {
      list-style-type: none;
      padding: 0;
      margin-bottom: 20px;
    }

    .puzzle-list-item {
      padding: 10px;
      border: 1px solid #bdc3c7;
      margin-bottom: 5px;
      background-color: white;
      cursor: pointer;
    }

    .puzzle-form {
      background-color: white;
      padding: 15px;
      border: 1px solid #bdc3c7;
    }

    /* לשונית ייצוא */
    .export-section {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="generator">
    <!-- סרגל צד -->
    <div class="sidebar">
      <h2>מחולל חדרי בריחה</h2>

      <div class="sidebar-section">
        <div class="section-title">חדרים</div>
        <ul class="rooms-list" id="rooms-list">
          <li class="room-item-list active" data-room-id="room1">חדר 1: מעבדה</li>
        </ul>
        <button class="btn" id="add-room-btn" style="width: 100%; margin-top: 10px;">+ הוסף חדר</button>
      </div>

      <div class="sidebar-section">
        <div class="section-title">אובייקטים</div>
        <div class="object-gallery" id="object-gallery">
          <div class="object-thumbnail" data-type="safe">כספת</div>
          <div class="object-thumbnail" data-type="key">מפתח</div>
          <div class="object-thumbnail" data-type="book">ספר</div>
          <div class="object-thumbnail" data-type="computer">מחשב</div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="section-title">הגדרות חדר</div>
        <div class="form-group">
          <label for="room-name">שם החדר:</label>
          <input type="text" id="room-name" value="חדר 1: מעבדה">
        </div>
        <div class="form-group">
          <label for="room-background">רקע החדר:</label>
          <select id="room-background">
            <option value="lab">מעבדה</option>
            <option value="library">ספרייה</option>
            <option value="office">משרד</option>
          </select>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="section-title">תכונות האובייקט</div>
        <div id="object-properties" style="display: none;">
          <div class="form-group">
            <label for="object-name">שם:</label>
            <input type="text" id="object-name">
          </div>
          <div class="form-group">
            <label for="object-puzzle">חידה מקושרת:</label>
            <select id="object-puzzle">
              <option value="">ללא</option>
              <option value="code-puzzle">חידת קוד</option>
              <option value="text-puzzle">חידת טקסט</option>
            </select>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="object-locked">
              נעול (דורש פריט)
            </label>
          </div>
          <div class="form-group">
            <label for="object-required-item">פריט נדרש:</label>
            <select id="object-required-item">
              <option value="">ללא</option>
              <option value="key">מפתח</option>
            </select>
          </div>
          <div class="form-group">
            <label for="object-next-room">מעבר לחדר:</label>
            <select id="object-next-room">
              <option value="">ללא</option>
              <option value="room2">חדר 2</option>
            </select>
          </div>
          <button class="btn btn-danger" id="delete-object-btn">מחק אובייקט</button>
        </div>
        <div id="no-object-selected" style="text-align: center; padding: 10px;">
          בחר אובייקט כדי לערוך את תכונותיו
        </div>
      </div>
    </div>

    <!-- תוכן ראשי -->
    <div class="main-content">
      <div class="toolbar">
        <div>
          <button class="btn" id="new-project-btn">פרויקט חדש</button>
          <button class="btn" id="save-project-btn">שמור</button>
          <button class="btn" id="load-project-btn">טען</button>
        </div>
        <div>
          <button class="btn btn-success" id="export-btn">ייצא משחק</button>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="rooms">חדרים</button>
        <button class="tab" data-tab="puzzles">חידות</button>
        <button class="tab" data-tab="map">מפה</button>
        <button class="tab" data-tab="export">ייצוא</button>
      </div>

      <div class="preview-area">
        <!-- לשונית חדרים -->
        <div class="tab-content active" id="rooms-tab">
          <div class="room-preview" id="room-preview" style="background-color: #243447;">
            <!-- חדר דוגמה עם פריטים -->
            <div class="room-item" id="item1" style="width: 60px; height: 60px; left: 200px; top: 300px;" data-type="safe">
              כספת
            </div>

            <div class="room-item" id="item2" style="width: 50px; height: 50px; left: 400px; top: 150px;" data-type="computer">
              מחשב
            </div>
          </div>
        </div>

        <!-- לשונית חידות -->
        <div class="tab-content" id="puzzles-tab" style="display: none;">
          <div class="puzzle-editor">
            <h3>חידות</h3>
            <p>כאן תוכל ליצור ולערוך חידות לחדרי הבריחה שלך.</p>

            <div class="puzzle-list">
              <div class="puzzle-list-item" data-puzzle-id="code-puzzle">חידת קוד - כספת</div>
              <div class="puzzle-list-item" data-puzzle-id="text-puzzle">חידת טקסט - מחשב</div>
            </div>

            <button class="btn" id="add-puzzle-btn">+ הוסף חידה חדשה</button>

            <div class="puzzle-form" id="code-puzzle-form" style="display: none; margin-top: 20px;">
              <h4>עריכת חידת קוד</h4>
              <div class="form-group">
                <label for="code-puzzle-name">שם החידה:</label>
                <input type="text" id="code-puzzle-name" value="חידת קוד - כספת">
              </div>
              <div class="form-group">
                <label for="code-puzzle-description">תיאור החידה:</label>
                <textarea id="code-puzzle-description" rows="3">מצא את הקוד לפתיחת הכספת!</textarea>
              </div>
              <div class="form-group">
                <label for="code-puzzle-answer">הקוד הנכון:</label>
                <input type="text" id="code-puzzle-answer" value="1234">
              </div>
              <div class="form-group">
                <label for="code-puzzle-hint">רמז:</label>
                <input type="text" id="code-puzzle-hint" value="חפש רמזים בחדר...">
              </div>
              <div class="form-group">
                <label for="code-puzzle-success">הודעת הצלחה:</label>
                <input type="text" id="code-puzzle-success" value="הכספת נפתחה!">
              </div>
              <button class="btn" id="save-code-puzzle">שמור</button>
            </div>

            <div class="puzzle-form" id="text-puzzle-form" style="display: none; margin-top: 20px;">
              <h4>עריכת חידת טקסט</h4>
              <div class="form-group">
                <label for="text-puzzle-name">שם החידה:</label>
                <input type="text" id="text-puzzle-name" value="חידת טקסט - מחשב">
              </div>
              <div class="form-group">
                <label for="text-puzzle-question">שאלה:</label>
                <textarea id="text-puzzle-question" rows="3">מהו שמו של המדען הידוע שגילה את חוק הכבידה?</textarea>
              </div>
              <div class="form-group">
                <label for="text-puzzle-answer">תשובה נכונה:</label>
                <input type="text" id="text-puzzle-answer" value="אייזק ניוטון">
              </div>
              <div class="form-group">
                <label for="text-puzzle-hint">רמז:</label>
                <input type="text" id="text-puzzle-hint" value="הוא ראה תפוח נופל...">
              </div>
              <div class="form-group">
                <label for="text-puzzle-success">הודעת הצלחה:</label>
                <input type="text" id="text-puzzle-success" value="נכון! המחשב נפתח!">
              </div>
              <button class="btn" id="save-text-puzzle">שמור</button>
            </div>
          </div>
        </div>

        <!-- לשונית מפה -->
        <div class="tab-content" id="map-tab" style="display: none;">
          <div class="map-editor">
            <h3>מפת חדרים</h3>
            <p>גרור חדרים למפה וצור קשרים ביניהם.</p>

            <div class="map-container" id="map-container">
              <div class="map-room" id="map-room1" style="top: 50px; left: 50px;" data-room-id="room1">
                חדר 1: מעבדה
              </div>
              <div class="map-room" id="map-room2" style="top: 200px; left: 250px;" data-room-id="room2">
                חדר 2: ספרייה
              </div>
              <!-- קשרים בין חדרים יתווספו דינאמית ע"י ה-JavaScript -->
            </div>

            <div style="margin-top: 20px;">
              <button class="btn" id="add-map-room">+ הוסף חדר</button>
              <button class="btn" id="create-connection">צור קשר</button>
              <button class="btn btn-danger" id="remove-connection">מחק קשר</button>
            </div>
          </div>
        </div>

        <!-- לשונית ייצוא -->
        <div class="tab-content" id="export-tab" style="display: none;">
          <div class="export-section">
            <h3>ייצוא משחק</h3>
            <p>ייצא את חדר הבריחה שלך כקובץ HTML שניתן לשתף ולהפעיל בכל דפדפן.</p>

            <div class="form-group">
              <label for="game-title">כותרת המשחק:</label>
              <input type="text" id="game-title" value="חדר הבריחה שלי - המעבדה המסתורית">
            </div>

            <div class="form-group">
              <label for="game-description">תיאור המשחק:</label>
              <textarea id="game-description" rows="4">ברוכים הבאים לחדר הבריחה המקוון! מצאת את עצמך נעול במעבדה מסתורית. עליך לפתור את החידות ולמצוא את הדרך החוצה תוך 60 דקות.</textarea>
            </div>

            <div class="form-group">
              <label for="game-time-limit">הגבלת זמן (בדקות):</label>
              <input type="number" id="game-time-limit" value="60">
            </div>

            <button class="btn btn-success" id="generate-game">ייצא משחק</button>

            <div style="margin-top: 20px; display: none;" id="export-result">
              <h4>המשחק מוכן להורדה!</h4>
              <p>לחץ על הכפתור למטה כדי להוריד את המשחק:</p>
              <button class="btn btn-success" id="download-game">הורד משחק</button>
            </div>
          </div>
        </div>

        <!-- מודאלים -->
        <div class="modal" id="add-room-modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>הוסף חדר חדש</h3>
            <div class="form-group">
              <label for="new-room-name">שם החדר:</label>
              <input type="text" id="new-room-name" value="חדר חדש">
            </div>
            <div class="form-group">
              <label for="new-room-background">רקע:</label>
              <select id="new-room-background">
                <option value="lab">מעבדה</option>
                <option value="library">ספרייה</option>
                <option value="office">משרד</option>
                <option value="mansion">אחוזה</option>
              </select>
            </div>
            <button class="btn btn-success" id="create-room-btn">צור חדר</button>
          </div>
        </div>

        <div class="modal" id="add-puzzle-modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>הוסף חידה חדשה</h3>
            <div class="form-group">
              <label for="new-puzzle-type">סוג החידה:</label>
              <select id="new-puzzle-type">
                <option value="code">חידת קוד</option>
                <option value="text">חידת טקסט</option>
                <option value="search">חידת חיפוש</option>
                <option value="sequence">חידת רצף</option>
              </select>
            </div>
            <div class="form-group">
              <label for="new-puzzle-name">שם החידה:</label>
              <input type="text" id="new-puzzle-name" value="חידה חדשה">
            </div>
            <button class="btn btn-success" id="create-puzzle-btn">צור חידה</button>
          </div>
        </div>

        <div class="modal" id="export-game-modal">
          <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>ייצוא המשחק</h3>
            <p>המשחק שלך מוכן להורדה! ייצרנו עבורך קובץ HTML שניתן לפתוח ישירות בכל דפדפן מודרני.</p>
            <div style="background-color: #f4f4f4; padding: 10px; border-radius: 5px; margin: 15px 0;">
              <p style="margin: 0;"><strong>הוראות:</strong><br/>
              1. הורד את הקובץ<br/>
              2. פתח את הקובץ בכל דפדפן<br/>
              3. שתף את הקובץ עם חברים כדי שיוכלו לשחק</p>
            </div>
            <button class="btn btn-success" id="download-game-btn">הורד משחק</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- קוד JavaScript -->
  <script>
    // מידע אודות הפרויקט
    var projectData = {
      name: "חדר הבריחה שלי",
      rooms: {
        room1: {
          id: "room1",
          name: "חדר 1: מעבדה",
          background: "lab",
          items: {
            item1: {
              id: "item1",
              name: "כספת",
              type: "safe",
              x: 200,
              y: 300,
              width: 60,
              height: 60,
              puzzle: "code-puzzle",
              locked: true,
              requiredItem: null,
              nextRoom: null
            },
            item2: {
              id: "item2",
              name: "מחשב",
              type: "computer",
              x: 400,
              y: 150,
              width: 50,
              height: 50,
              puzzle: "text-puzzle",
              locked: false,
              requiredItem: null,
              nextRoom: null
            }
          }
        },
        room2: {
          id: "room2",
          name: "חדר 2: ספרייה",
          background: "library",
          items: {}
        }
      },
      puzzles: {
        "code-puzzle": {
          id: "code-puzzle",
          name: "חידת קוד - כספת",
          type: "code",
          description: "מצא את הקוד לפתיחת הכספת!",
          answer: "1234",
          hint: "חפש רמזים בחדר...",
          successMessage: "הכספת נפתחה!"
        },
        "text-puzzle": {
          id: "text-puzzle",
          name: "חידת טקסט - מחשב",
          type: "text",
          question: "מהו שמו של המדען הידוע שגילה את חוק הכבידה?",
          answer: "אייזק ניוטון",
          hint: "הוא ראה תפוח נופל...",
          successMessage: "נכון! המחשב נפתח!"
        }
      },
      connections: [
        { from: "room1", to: "room2", requiredPuzzle: "code-puzzle" }
      ],
      settings: {
        title: "חדר הבריחה שלי - המעבדה המסתורית",
        description: "ברוכים הבאים לחדר הבריחה המקוון! מצאת את עצמך נעול במעבדה מסתורית. עליך לפתור את החידות ולמצוא את הדרך החוצה תוך 60 דקות.",
        timeLimit: 60
      }
    };

    // חדר נוכחי שמוצג
    var currentRoomId = "room1";

    // אובייקט נבחר
    var selectedItem = null;

    // פונקציה לטעינת החדר הנוכחי
    function loadCurrentRoom() {
      // נקה את תצוגת החדר
      var roomPreview = document.getElementById("room-preview");
      // מחק את כל האובייקטים, אבל השאר את החדר עצמו
      var items = roomPreview.querySelectorAll(".room-item");
      for (var i = 0; i < items.length; i++) {
        items[i].remove();
      }

      // הגדר את הרקע של החדר
      var room = projectData.rooms[currentRoomId];
      if (room.background === "lab") {
        roomPreview.style.backgroundColor = "#243447";
      } else if (room.background === "library") {
        roomPreview.style.backgroundColor = "#4b3621";
      } else if (room.background === "office") {
        roomPreview.style.backgroundColor = "#34515e";
      } else if (room.background === "mansion") {
        roomPreview.style.backgroundColor = "#544e4d";
      }

      // הוסף את כל האובייקטים בחדר
      for (var itemId in room.items) {
        var item = room.items[itemId];
        var itemElement = document.createElement("div");
        itemElement.id = item.id;
        itemElement.className = "room-item";
        itemElement.style.width = item.width + "px";
        itemElement.style.height = item.height + "px";
        itemElement.style.left = item.x + "px";
        itemElement.style.top = item.y + "px";
        itemElement.setAttribute("data-type", item.type);
        itemElement.textContent = item.name;

        // הוסף את האובייקט לחדר
        roomPreview.appendChild(itemElement);

        // טיפול באירועי עכבר
        itemElement.addEventListener("mousedown", selectItem);
        itemElement.addEventListener("mousemove", moveItem);
        itemElement.addEventListener("mouseup", deselectItem);
      }

      // עדכן את שם החדר
      document.getElementById("room-name").value = room.name;

      // עדכן את הרקע בתפריט
      document.getElementById("room-background").value = room.background;

      // עדכן את הרשימה של החדרים
     var roomItems = document.querySelectorAll(".room-item-list");
     for (var i = 0; i < roomItems.length; i++) {
       roomItems[i].classList.remove("active");
       if (roomItems[i].getAttribute("data-room-id") === currentRoomId) {
         roomItems[i].classList.add("active");
       }
     }
   }

   // פונקציה לבחירת אובייקט
   function selectItem(e) {
     // שמור את האובייקט הנבחר
     selectedItem = {
       element: this,
       offsetX: e.clientX - this.getBoundingClientRect().left,
       offsetY: e.clientY - this.getBoundingClientRect().top,
       moving: true
     };

     // סמן את האובייקט בחזותית
     var items = document.querySelectorAll(".room-item");
     for (var i = 0; i < items.length; i++) {
       items[i].classList.remove("selected");
     }
     this.classList.add("selected");

     // הצג את התכונות שלו
     showItemProperties(this.id);

     // מנע ברירת מחדל של האירוע
     e.preventDefault();
   }

   // פונקציה להזזת אובייקט
   function moveItem(e) {
     if (selectedItem && selectedItem.moving && selectedItem.element === this) {
       var roomPreview = document.getElementById("room-preview");
       var roomRect = roomPreview.getBoundingClientRect();

       var newX = e.clientX - roomRect.left - selectedItem.offsetX;
       var newY = e.clientY - roomRect.top - selectedItem.offsetY;

       // וודא שהאובייקט נשאר בגבולות החדר
       var width = parseInt(this.style.width);
       var height = parseInt(this.style.height);

       newX = Math.max(0, Math.min(newX, roomRect.width - width));
       newY = Math.max(0, Math.min(newY, roomRect.height - height));

       // עדכן את המיקום
       this.style.left = newX + "px";
       this.style.top = newY + "px";

       // עדכן את מידע האובייקט בפרויקט
       var itemId = this.id;
       projectData.rooms[currentRoomId].items[itemId].x = newX;
       projectData.rooms[currentRoomId].items[itemId].y = newY;
     }
   }

   // פונקציה לשחרור אובייקט
   function deselectItem() {
     if (selectedItem && selectedItem.element === this) {
       selectedItem.moving = false;
     }
   }

   // פונקציה להצגת תכונות של אובייקט נבחר
   function showItemProperties(itemId) {
     var item = projectData.rooms[currentRoomId].items[itemId];
     if (!item) return;

     // הצג את פאנל התכונות
     document.getElementById("no-object-selected").style.display = "none";
     document.getElementById("object-properties").style.display = "block";

     // מלא את הערכים בטופס
     document.getElementById("object-name").value = item.name;
     document.getElementById("object-puzzle").value = item.puzzle || "";
     document.getElementById("object-locked").checked = item.locked;
     document.getElementById("object-required-item").value = item.requiredItem || "";
     document.getElementById("object-next-room").value = item.nextRoom || "";
   }

   // פונקציה להוספת אובייקט חדש
   function addNewItem(type) {
     // צור מזהה ייחודי
     var itemCount = Object.keys(projectData.rooms[currentRoomId].items).length;
     var newItemId = "item" + (itemCount + 1);

     // הגדר מידות ברירת מחדל לפי הסוג
     var width = 50, height = 50;
     var name = "";

     if (type === "safe") {
       width = 60;
       height = 60;
       name = "כספת";
     } else if (type === "key") {
       width = 40;
       height = 40;
       name = "מפתח";
     } else if (type === "book") {
       width = 50;
       height = 40;
       name = "ספר";
     } else if (type === "computer") {
       width = 50;
       height = 50;
       name = "מחשב";
     }

     // הוסף את האובייקט לנתוני הפרויקט
     projectData.rooms[currentRoomId].items[newItemId] = {
       id: newItemId,
       name: name,
       type: type,
       x: 200,
       y: 200,
       width: width,
       height: height,
       puzzle: "",
       locked: false,
       requiredItem: null,
       nextRoom: null
     };

     // טען מחדש את החדר
     loadCurrentRoom();
   }

   // פונקציה למחיקת אובייקט
   function deleteSelectedItem() {
     if (selectedItem) {
       var itemId = selectedItem.element.id;
       delete projectData.rooms[currentRoomId].items[itemId];

       // טען מחדש את החדר
       loadCurrentRoom();

       // הסתר את תכונות האובייקט
       document.getElementById("object-properties").style.display = "none";
       document.getElementById("no-object-selected").style.display = "block";

       selectedItem = null;
     }
   }

   // פונקציה להוספת חדר חדש
   function addNewRoom() {
     var roomName = document.getElementById("new-room-name").value;
     var roomBackground = document.getElementById("new-room-background").value;

     // צור מזהה ייחודי
     var roomCount = Object.keys(projectData.rooms).length;
     var newRoomId = "room" + (roomCount + 1);

     // הוסף את החדר לנתוני הפרויקט
     projectData.rooms[newRoomId] = {
       id: newRoomId,
       name: roomName,
       background: roomBackground,
       items: {}
     };

     // עדכן את רשימת החדרים
     var roomsList = document.getElementById("rooms-list");
     var li = document.createElement("li");
     li.className = "room-item-list";
     li.setAttribute("data-room-id", newRoomId);
     li.textContent = roomName;
     li.addEventListener("click", function() {
       currentRoomId = this.getAttribute("data-room-id");
       loadCurrentRoom();
     });
     roomsList.appendChild(li);

     // סגור את המודאל
     document.getElementById("add-room-modal").style.display = "none";

     // עדכן את רשימת החדרים בתפריט של "מעבר לחדר"
     var nextRoomSelect = document.getElementById("object-next-room");
     var option = document.createElement("option");
     option.value = newRoomId;
     option.textContent = roomName;
     nextRoomSelect.appendChild(option);
   }

   // פונקציה להוספת חידה חדשה
   function addNewPuzzle() {
     var puzzleType = document.getElementById("new-puzzle-type").value;
     var puzzleName = document.getElementById("new-puzzle-name").value;

     // צור מזהה ייחודי
     var puzzleCount = Object.keys(projectData.puzzles).length;
     var newPuzzleId = puzzleType + "-puzzle-" + (puzzleCount + 1);

     // הוסף את החידה לנתוני הפרויקט
     if (puzzleType === "code") {
       projectData.puzzles[newPuzzleId] = {
         id: newPuzzleId,
         name: puzzleName,
         type: "code",
         description: "הזן את הקוד הנכון",
         answer: "1234",
         hint: "חפש רמזים בחדר...",
         successMessage: "הצלחת!"
       };
     } else if (puzzleType === "text") {
       projectData.puzzles[newPuzzleId] = {
         id: newPuzzleId,
         name: puzzleName,
         type: "text",
         question: "ענה על השאלה",
         answer: "תשובה",
         hint: "רמז...",
         successMessage: "תשובה נכונה!"
       };
     }

     // עדכן את רשימת החידות
     var puzzleList = document.querySelector(".puzzle-list");
     var div = document.createElement("div");
     div.className = "puzzle-list-item";
     div.setAttribute("data-puzzle-id", newPuzzleId);
     div.textContent = puzzleName;
     div.addEventListener("click", function() {
       showPuzzleForm(this.getAttribute("data-puzzle-id"));
     });
     puzzleList.appendChild(div);

     // עדכן את רשימת החידות בתפריט של "חידה מקושרת"
     var puzzleSelect = document.getElementById("object-puzzle");
     var option = document.createElement("option");
     option.value = newPuzzleId;
     option.textContent = puzzleName;
     puzzleSelect.appendChild(option);

     // סגור את המודאל
     document.getElementById("add-puzzle-modal").style.display = "none";
   }

   // פונקציה להצגת טופס עריכת חידה
   function showPuzzleForm(puzzleId) {
     var puzzle = projectData.puzzles[puzzleId];
     if (!puzzle) return;

     // הסתר את כל טפסי החידות
     var puzzleForms = document.querySelectorAll(".puzzle-form");
     for (var i = 0; i < puzzleForms.length; i++) {
       puzzleForms[i].style.display = "none";
     }

     // הצג את הטופס המתאים
     if (puzzle.type === "code") {
       var form = document.getElementById("code-puzzle-form");
       form.style.display = "block";
       document.getElementById("code-puzzle-name").value = puzzle.name;
       document.getElementById("code-puzzle-description").value = puzzle.description;
       document.getElementById("code-puzzle-answer").value = puzzle.answer;
       document.getElementById("code-puzzle-hint").value = puzzle.hint;
       document.getElementById("code-puzzle-success").value = puzzle.successMessage;

       // קבע אירוע שמירה לטופס
       document.getElementById("save-code-puzzle").onclick = function() {
         savePuzzle(puzzleId, "code");
       };
     } else if (puzzle.type === "text") {
       var form = document.getElementById("text-puzzle-form");
       form.style.display = "block";
       document.getElementById("text-puzzle-name").value = puzzle.name;
       document.getElementById("text-puzzle-question").value = puzzle.question;
       document.getElementById("text-puzzle-answer").value = puzzle.answer;
       document.getElementById("text-puzzle-hint").value = puzzle.hint;
       document.getElementById("text-puzzle-success").value = puzzle.successMessage;

       // קבע אירוע שמירה לטופס
       document.getElementById("save-text-puzzle").onclick = function() {
         savePuzzle(puzzleId, "text");
       };
     }
   }

   // פונקציה לשמירת חידה
   function savePuzzle(puzzleId, type) {
     if (type === "code") {
       projectData.puzzles[puzzleId] = {
         id: puzzleId,
         name: document.getElementById("code-puzzle-name").value,
         type: "code",
         description: document.getElementById("code-puzzle-description").value,
         answer: document.getElementById("code-puzzle-answer").value,
         hint: document.getElementById("code-puzzle-hint").value,
         successMessage: document.getElementById("code-puzzle-success").value
       };

       // עדכן את שם החידה ברשימה
       var puzzleItem = document.querySelector('.puzzle-list-item[data-puzzle-id="' + puzzleId + '"]');
       if (puzzleItem) {
         puzzleItem.textContent = document.getElementById("code-puzzle-name").value;
       }

     } else if (type === "text") {
       projectData.puzzles[puzzleId] = {
         id: puzzleId,
         name: document.getElementById("text-puzzle-name").value,
         type: "text",
         question: document.getElementById("text-puzzle-question").value,
         answer: document.getElementById("text-puzzle-answer").value,
         hint: document.getElementById("text-puzzle-hint").value,
         successMessage: document.getElementById("text-puzzle-success").value
       };

       // עדכן את שם החידה ברשימה
       var puzzleItem = document.querySelector('.puzzle-list-item[data-puzzle-id="' + puzzleId + '"]');
       if (puzzleItem) {
         puzzleItem.textContent = document.getElementById("text-puzzle-name").value;
       }
     }

     // עדכן את רשימת החידות בתפריט של "חידה מקושרת"
     var puzzleSelect = document.getElementById("object-puzzle");
     var option = puzzleSelect.querySelector('option[value="' + puzzleId + '"]');
     if (option) {
       option.textContent = projectData.puzzles[puzzleId].name;
     }

     alert("החידה נשמרה בהצלחה!");
   }

   // פונקציה לעדכון המלאי במשחק (בקוד המיוצא)
   function createUpdateInventoryFunction() {
     return `
   // פונקציה לעדכון המלאי במשחק
   function updateInventoryUI() {
     // נקה את כל החריצים
     var slots = document.querySelectorAll(".inventory-slot");
     for (var i = 0; i < slots.length; i++) {
       slots[i].textContent = "";
       slots[i].setAttribute("data-item-type", "");
     }

     // מלא את החריצים לפי המלאי
     for (var i = 0; i < gameState.inventory.length; i++) {
       var itemType = gameState.inventory[i];
       var slotSelector = '.inventory-slot[data-slot="' + i + '"]';
       var slot = document.querySelector(slotSelector);

       if (slot) {
         slot.textContent = getTitleByType(itemType);
         slot.setAttribute("data-item-type", itemType);
       }
     }
   }

   // פונקציה לקבלת כותרת לפי סוג פריט
   function getTitleByType(type) {
     if (type === "key") return "מפתח";
     if (type === "book") return "ספר";
     return type;
   }`;
   }

   // פונקציה לייצוא המשחק כקובץ HTML
   // פונקציה לייצוא המשחק באמצעות גלופה
 function exportGame() {
   // עדכון נתוני הפרויקט מהטופס
   projectData.settings.title = document.getElementById("game-title").value;
   projectData.settings.description = document.getElementById("game-description").value;
   projectData.settings.timeLimit = parseInt(document.getElementById("game-time-limit").value);

   // ייבוא הגלופה
   fetch('escape-room-template.html')
     .then(response => response.text())
     .then(template => {
       // החלפת המקומות השמורים בגלופה
       var gameHTML = template
         .replace('{{GAME_TITLE}}', projectData.settings.title)
         .replace('{{GAME_DESCRIPTION}}', projectData.settings.description)
         .replace('{{GAME_TIME_LIMIT}}', projectData.settings.timeLimit)
         .replace('{{GAME_DATA_JSON}}', JSON.stringify(projectData));

       // יצירת והורדת הקובץ
       var blob = new Blob([gameHTML], { type: 'text/html;charset=utf-8' });
       var url = URL.createObjectURL(blob);
       var a = document.createElement('a');
       a.href = url;
       a.download = 'escape-room-game.html';
       document.body.appendChild(a);
       a.click();
       document.body.removeChild(a);
       URL.revokeObjectURL(url);

       // הצגת מודאל הצלחה
       document.getElementById("export-game-modal").style.display = "block";
     })
     .catch(error => {
       alert('אירעה שגיאה בטעינת הגלופה: ' + error);
     });
 }
   // פונקציה ליצירת קובץ להורדה
   function downloadGame() {
     var gameHTML = exportGame();

     // צור בלוב מהקוד
     var blob = new Blob([gameHTML], { type: "text/html" });

     // צור אובייקט URL
     var url = URL.createObjectURL(blob);

     // צור אלמנט קישור להורדה
     var a = document.createElement("a");
     a.href = url;
     a.download = "escape-room-game.html";

     // הוסף אותו זמנית לדף
     document.body.appendChild(a);

     // לחץ עליו
     a.click();

     // נקה
     setTimeout(function() {
       document.body.removeChild(a);
       URL.revokeObjectURL(url);
     }, 0);
   }

   // אירועים

   // טעינת הדף
   document.addEventListener("DOMContentLoaded", function() {
     // טען את החדר הנוכחי
     loadCurrentRoom();

     // אירועי לחיצה על הלשוניות
     var tabs = document.querySelectorAll(".tab");
     for (var i = 0; i < tabs.length; i++) {
       tabs[i].addEventListener("click", function() {
         // הסר סימון מכל הלשוניות
         var allTabs = document.querySelectorAll(".tab");
         for (var j = 0; j < allTabs.length; j++) {
           allTabs[j].classList.remove("active");
         }
         // סמן את הלשונית הנוכחית
         this.classList.add("active");

         // הסתר את כל התוכן
         var allContent = document.querySelectorAll(".tab-content");
         for (var j = 0; j < allContent.length; j++) {
           allContent[j].style.display = "none";
         }

         // הצג את התוכן המתאים
         var tabId = this.getAttribute("data-tab") + "-tab";
         document.getElementById(tabId).style.display = "block";
       });
     }

     // אירועי לחיצה על אובייקטי הגלריה
     var thumbnails = document.querySelectorAll(".object-thumbnail");
     for (var i = 0; i < thumbnails.length; i++) {
       thumbnails[i].addEventListener("click", function() {
         addNewItem(this.getAttribute("data-type"));
       });
     }

     // אירועי לחיצה על רשימת החדרים
     var roomItems = document.querySelectorAll(".room-item-list");
     for (var i = 0; i < roomItems.length; i++) {
       roomItems[i].addEventListener("click", function() {
         currentRoomId = this.getAttribute("data-room-id");
         loadCurrentRoom();
       });
     }

     // אירוע לחיצה על כפתור הוספת חדר
     document.getElementById("add-room-btn").addEventListener("click", function() {
       document.getElementById("add-room-modal").style.display = "block";
     });

     // אירוע לחיצה על כפתור הוספת חידה
     document.getElementById("add-puzzle-btn").addEventListener("click", function() {
       document.getElementById("add-puzzle-modal").style.display = "block";
     });

     // אירוע לחיצה על כפתור יצירת חדר חדש
     document.getElementById("create-room-btn").addEventListener("click", addNewRoom);

     // אירוע לחיצה על כפתור יצירת חידה חדשה
     document.getElementById("create-puzzle-btn").addEventListener("click", addNewPuzzle);

     // אירוע לחיצה על פריט בגלריית החידות
     var puzzleItems = document.querySelectorAll(".puzzle-list-item");
     for (var i = 0; i < puzzleItems.length; i++) {
       puzzleItems[i].addEventListener("click", function() {
         showPuzzleForm(this.getAttribute("data-puzzle-id"));
       });
     }

     // אירוע לחיצה על כפתור מחיקת אובייקט
     document.getElementById("delete-object-btn").addEventListener("click", deleteSelectedItem);

     // אירוע לחיצה על כפתור ייצוא משחק
     document.getElementById("generate-game").addEventListener("click", exportGame);

     // אירוע לחיצה על כפתור הורדת משחק
     document.getElementById("download-game-btn").addEventListener("click", downloadGame);

     // אירועי סגירת מודאלים
     var closeButtons = document.querySelectorAll(".close-modal");
     for (var i = 0; i < closeButtons.length; i++) {
       closeButtons[i].addEventListener("click", function() {
         this.closest(".modal").style.display = "none";
       });
     }

     // אירוע עדכון שם חדר
     document.getElementById("room-name").addEventListener("change", function() {
       projectData.rooms[currentRoomId].name = this.value;
       var roomItem = document.querySelector('.room-item-list[data-room-id="' + currentRoomId + '"]');
       if (roomItem) {
         roomItem.textContent = this.value;
       }
     });

     // אירוע שינוי רקע חדר
     document.getElementById("room-background").addEventListener("change", function() {
       projectData.rooms[currentRoomId].background = this.value;
       loadCurrentRoom();
     });

     // אירועי עדכון תכונות אובייקט
     document.getElementById("object-name").addEventListener("change", function() {
       if (selectedItem) {
         var itemId = selectedItem.element.id;
         projectData.rooms[currentRoomId].items[itemId].name = this.value;
         selectedItem.element.textContent = this.value;
       }
     });

     document.getElementById("object-puzzle").addEventListener("change", function() {
       if (selectedItem) {
         var itemId = selectedItem.element.id;
         projectData.rooms[currentRoomId].items[itemId].puzzle = this.value || null;
       }
     });

     document.getElementById("object-locked").addEventListener("change", function() {
       if (selectedItem) {
         var itemId = selectedItem.element.id;
         projectData.rooms[currentRoomId].items[itemId].locked = this.checked;
       }
     });

     document.getElementById("object-required-item").addEventListener("change", function() {
       if (selectedItem) {
         var itemId = selectedItem.element.id;
         projectData.rooms[currentRoomId].items[itemId].requiredItem = this.value || null;
       }
     });

     document.getElementById("object-next-room").addEventListener("change", function() {
       if (selectedItem) {
         var itemId = selectedItem.element.id;
         projectData.rooms[currentRoomId].items[itemId].nextRoom = this.value || null;
       }
     });

     // אירועי שמירה וטעינה של פרויקט
     document.getElementById("save-project-btn").addEventListener("click", function() {
       localStorage.setItem("escape-room-project", JSON.stringify(projectData));
       alert("הפרויקט נשמר בהצלחה!");
     });

     document.getElementById("load-project-btn").addEventListener("click", function() {
       var savedProject = localStorage.getItem("escape-room-project");
       if (savedProject) {
         try {
           projectData = JSON.parse(savedProject);
           currentRoomId = Object.keys(projectData.rooms)[0] || "room1";

           // עדכן את רשימת החדרים
           var roomsList = document.getElementById("rooms-list");
           roomsList.innerHTML = "";
           for (var roomId in projectData.rooms) {
             var room = projectData.rooms[roomId];
             var li = document.createElement("li");
             li.className = "room-item-list" + (roomId === currentRoomId ? " active" : "");
             li.setAttribute("data-room-id", roomId);
             li.textContent = room.name;
             li.addEventListener("click", function() {
               currentRoomId = this.getAttribute("data-room-id");
               loadCurrentRoom();
             });
             roomsList.appendChild(li);
           }

           loadCurrentRoom();
           alert("הפרויקט נטען בהצלחה!");
         } catch (e) {
           alert("שגיאה בטעינת הפרויקט: " + e.message);
         }
       } else {
         alert("לא נמצא פרויקט שמור!");
       }
     });

     // אירוע פרויקט חדש
     document.getElementById("new-project-btn").addEventListener("click", function() {
       if (confirm("האם אתה בטוח שברצונך ליצור פרויקט חדש? כל השינויים שלא נשמרו יאבדו.")) {
         projectData = {
           name: "חדר הבריחה שלי",
           rooms: {
             room1: {
               id: "room1",
               name: "חדר 1: מעבדה",
               background: "lab",
               items: {}
             }
           },
           puzzles: {},
           connections: [],
           settings: {
             title: "חדר הבריחה שלי",
             description: "ברוכים הבאים לחדר הבריחה המקוון!",
             timeLimit: 60
           }
         };

         // עדכן את רשימת החדרים
         var roomsList = document.getElementById("rooms-list");
         roomsList.innerHTML = '<li class="room-item-list active" data-room-id="room1">חדר 1: מעבדה</li>';
         var roomItem = document.querySelector(".room-item-list");
         roomItem.addEventListener("click", function() {
           currentRoomId = this.getAttribute("data-room-id");
           loadCurrentRoom();
         });

         currentRoomId = "room1";
         loadCurrentRoom();

         // נקה את בחירת האובייקט
         selectedItem = null;
         document.getElementById("object-properties").style.display = "none";
         document.getElementById("no-object-selected").style.display = "block";
       }
     });
   });
 </script>
</body>
</html>
